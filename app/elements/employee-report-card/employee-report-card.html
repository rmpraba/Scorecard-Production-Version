<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="employee-report-card">
  <template>
    <style>
      :host {
        display: block;
      }
       .title
      {
        margin-left: 40%;
      }
      
     .tabl1
      {
          margin-left: 15%;
          margin-top: 4%;
           border-collapse: collapse;

      }
      #grade{
        margin-left: 40%;
      }
     #tb3{
          width:7.5%;
    }
     #tb2{
      width:17%;
    }
     #tb4{
      width:22.5%;
    }
    #tb1{
      width:37.5%;
    }
    #tb5{
      width:10%;
    }
    #btn{
      width: 10%;
      background: #252626;
      color: white;
      margin-top: 5%;
      height: 30px;
      border-radius: 4%;
      font-family: Calibri;
      font-size: 17px;
      margin-left: 40%;
      }

    </style>
     <div class="title">
        <h3><b>EMPLOYEE REPORT</b></h3>
      </div>


         <!--  <paper-dropdown-menu id="acadid" label="Select Acadamic year">
            <paper-menu id="rtermmm" class="dropdown-content"   on-iron-select="Fnyear" attr-for-selected="value" required>
                <paper-item value="2016-2017">2016-2017</paper-item>
                <paper-item value="2017-2018">2017-2018</paper-item>
                <paper-item value="2018-2019">2018-2019</paper-item>
                <paper-item value="2019-2020">2019-2020</paper-item>
            </paper-menu>
          </paper-dropdown-menu> -->
          <paper-dropdown-menu id="grade" label="Select Employee">
            <paper-menu id="empdddd" class="dropdown-content" on-iron-select="Fnemp">     
              <template is="dom-repeat" items="{{selectemparry}}">
                <paper-item value="{{item.id}}">{{item.name}}</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
    
     <table border="1" class="tabl1" id="tabledetails">
      <tr>
      <th id="tb5">Employee ID</th>
      <th id="tb1">Employee Name</th>
      <th  id="tb3">Grade</th>
      <th  id="tb4">Subject</th>
      <th  id="tb2">Section</th>
     
      </tr>

      
          
      <template is="dom-repeat" items="{{emp1aaaa}}" as="view">
      <tr>
       <td>{{view.id}}</td>
       <td>{{view.name}}</td>
       <td>{{view.grade_name}}</td>
       <td>{{view.subject_name}}</td>
       <td>{{view.section_id}}</td>
      

      </tr> 

      </template>
      </table>
      <input type="button" id="btn" onclick="tableToExcel('tabledetails', 'Mark Report')" value="Export to Excel"> 

  <iron-ajax        
        id="Getempajax"
        url="{{Getempurl}}"
        params="{{Getempparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="GetempResponse"
        debounce-duration="300"
        > 
  </template>
   <script type="text/javascript">
var tableToExcel = (function() {
  var uri = 'data:application/vnd.ms-excel;base64,'
    , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
    , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
    , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
  return function(table, name) {
    if (!table.nodeType) table = document.getElementById(table)
    var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
    window.location.href = uri + base64(format(template, ctx))
  }
})()
</script>

  <employee-report-service id="empservice"></employee-report-service>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'employee-report-card',
             
             ready:function()
             {
                this.$.btn.hidden=true;
                this.$.tabledetails.hidden=true;

             },
            Fnemp:function(e)
            {
               
               this.emp=e.target.selectedItem.textContent.trim();
               this.empid=e.target.selectedItem.value;

              this.Getempurl=sessionStorage.getItem("addrinfo")+"/empreport-service";
          var obj={"school_id":"","academic_year":"","id":""};
          obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
          obj.academic_year=localStorage.getItem("curr_sess_academicyear"); 
          obj.id=this.empid;
          this.Getempparam=obj;
         // alert(JSON.stringify(obj));
          this.$.Getempajax.generateRequest();
          this.$.btn.hidden=false;
           this.$.tabledetails.hidden=false;

            },

   GetempResponse:function(e)
       {
         var emp1=e.detail.response.returnval;
         this.emp1aaaa=emp1;
         // alert(JSON.stringify(this.emp1aaaa));

         // document.querySelector('emplyee-report-item-card').emparr=emp1;
       },
       FnRefresh:function()
       {
        //alert(44444);
         document.querySelector('#empdddd').selected=-1;
         this.$.tabledetails.hidden=true;
         this.$.btn.hidden=true;
         this.emp1aaaa=[];
       }


    });
  })();
  </script>
</dom-module>
