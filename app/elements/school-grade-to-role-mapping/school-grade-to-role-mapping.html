
<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="school-grade-to-role-mapping">
  <template>
    <style>
    paper-button{
      @apply(--layout-left);
      background-color: #363636;
      color: #ffffff;
      /*width: 12%;*/
      margin-left: 5%;
      margin-top: 2%;
    }
    tr{
      height: 40px;
    }
    </style>
    <div>
      <CENTER>
        <h3><b>ROLE TO GRADE MAPPING</b></h3>
      </CENTER>
    </div>
    <div>
      <table width="50%" style="margin-left: 20%;">
      <tr><th colspan="3">Select Role To Map</th></tr>
      <tr>
        <td colspan="2">
          <template is="dom-repeat" items="{{rolesarr}}">
          <role-to-grade-roles-card id="{{item.id}}" name="{{item.role_name}}"></role-to-grade-roles-card>
          </template>
        </td>
        <td>
        <paper-dropdown-menu  label="Select Type">
            <paper-menu id="gradetoroleschooltype" class="dropdown-content"   on-iron-select="FnSelectType">
              <template is="dom-repeat" items="{{schooltypearr}}">
                <paper-item value="{{item.school_type_id}}">{{item.school_type_name}}</paper-item>
              </template>    
            </paper-menu>
        </paper-dropdown-menu>
        </td>
      </tr>
      <tr hidden$="{{hidegradeselection}}">
      <td colspan="2">
        <paper-dropdown-menu  label="Select Grade">
            <paper-menu id="gradetorolegrade" class="dropdown-content"   on-iron-select="FnSelectGrade">
              <template is="dom-repeat" items="{{gradearr}}">
                <paper-item value="{{item.grade_id}}">{{item.grade_name}}
                </paper-item>
              </template>    
            </paper-menu>
        </paper-dropdown-menu>
      </td>
      <td colspan="1"><paper-button on-click="FnGenerate">Generate
      </paper-button></td>
      </tr>
      <tr hidden$="{{hidegeneratebtn}}"><td colspan="2"></td>
      <td><paper-button on-click="FnGenerate">Generate
      </paper-button></td>
      </tr>
      </table>
    </div>
    <br><br>
    <div>
    <table width="60%" style="margin-left: 20%;">
    <!-- <template is="dom-repeat" items="{{emparr}}">
    <tr>
    <template is="dom-repeat" items="{{secarr}}">
    <td>
    <school-grade-to-role-mapping-item></school-grade-to-role-mapping-item>
    </td>
    </template>
    </tr>
    </template> -->
    <template is="dom-repeat" items="{{maparr}}">
    <tr>
    <template is="dom-repeat" items="{{item.row}}" as="i">
    <td><school-grade-to-role-mapping-item compid="{{i.compid}}" flag="{{i.flag}}" flagg="{{i.flagg}}" check="{{i.checked}}" class="{{i.class}}" section="{{i.section}}" empid="{{i.empid}}" empname="{{i.empname}}" flage="{{i.flage}}" schooltype="{{i.schooltype}}" academicyear="{{i.academicyear}}" roleid="{{i.roleid}}" classid="{{i.classid}}"></school-grade-to-role-mapping-item></td>
    </template>
    </tr>
    </template>
    </table>
    <div hidden$="{{hidebtn}}" style="margin-left: 40%;">
    <paper-button on-click="FnSave">Save</paper-button>
    <paper-button on-click="FnCancel">Cancel</paper-button>
    </div>
    </div>
    <div hidden><school-grade-to-role-mapping-item id="sgtrmi"></school-grade-to-role-mapping-item></div>
    <mapping-service id="mappingservice"></mapping-service>
  </template>
  <script>
  (function() {
    'use strict';
    var gradeid,type,roleid,gradename;    
    var mappingarr=[];
    Polymer({
      is: 'school-grade-to-role-mapping',
      ready:function(){
        this.hidebtn=true;
        this.hidegradeselection=true;
        this.hidegeneratebtn=true;
      },
      FnSelectType:function(e){
        type=e.target.selectedItem.value;
        this.$.mappingservice.fetchgradesforgradetorolemapService(type);
      },
      FnSelectGrade:function(e){
        gradeid=e.target.selectedItem.value;
        gradename=(e.target.selectedItem.textContent).trim();
      },
      FnSetRole:function(selectedrole){
        this.FnCancel();
        roleid=selectedrole;
        if(roleid=='class-teacher'){
        this.hidegradeselection=false;
        }
        else if(roleid=='co-ordinator'||roleid=='headmistress'){
        this.hidegeneratebtn=false;
        // this.$.mappingservice.fetchgradesforgradetorolemapService(type);
        }
      },
      FnGenerate:function(){
        if(roleid=='class-teacher')
        this.$.mappingservice.FnGenerateMappingInfo(type,gradeid,gradename,roleid);
        else
        this.$.mappingservice.FnGenerateMappingInfo1(type,roleid);
      },
      FnSetMappingarr:function(arr){
        mappingarr=arr;
      },
      FnSave:function(){
        // alert(mappingarr.length);
        // alert(JSON.stringify(mappingarr));
        this.$.mappingservice.FnDeleteMappingService(mappingarr);
      },
      FnCancel:function(){
        mappingarr=[];
        // this.rolesarr=[];
        this.maparr=[];
        this.hidebtn=true;
        this.hidegradeselection=true;
        this.hidegeneratebtn=true;
        document.querySelector('#gradetoroleschooltype').selected=-1;
        document.querySelector('#gradetorolegrade').selected=-1;
      },
      FnSetSelectedRole:function(rolearr){
        // alert(document.querySelector('school-grade-to-role-mapping-item'));
        this.$.sgtrmi.FnSetSelectedRole(rolearr);
        // arr=rolearr;
        // alert(JSON.stringify(arr));
      },
      FnRefresh:function(){
        mappingarr=[];
        this.rolesarr=[];
        this.maparr=[];
        this.hidebtn=true;
        this.hidegradeselection=true;
        document.querySelector('#gradetoroleschooltype').selected=-1;
        document.querySelector('#gradetorolegrade').selected=-1;
      }
    });
  })();
  </script>
</dom-module>
