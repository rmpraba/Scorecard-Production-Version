<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<dom-module id="student-to-subject-mapping-card">
  <template>
    <style>
      :host {
        display: block;
      }
       .card{
      width: 100%;        
      @apply(--layout-vertical);
      }
      .inner{
      @apply(--layout-horizontal);
      margin-left:20%;
      }
      .list{
      margin-left:10%;
      margin-top: 5%;
      }
      paper-dropdown-menu{
        margin-left:5%;
      }      
      paper-dropdown-menu{
      width: 15%;
      /*margin-left: 3%;*/
      --paper-input-container-label: { color: red };
      text-align:center;
      }
      .title
      {
        margin-left: 40%;
      }
      .outcard
      {
      width:25% 
      margin-left:5.0em;
      }
       .innercard
       {     
        @apply(--layout-horizontal);
        width:100%
        margin-left:2.5em;
       }
     .innercard1
     {
       @apply(--layout-horizontal);
       width:100%
      margin-left:5.0em;
     }
    </style>
      <div class="title">
        <h3><b>LANGUAGE PREFERENCE</b></h3>
      </div>
          
      <div class="card">
          <div class="inner">
               <paper-input value="{{subjectselectid}}" hidden></paper-input>
               <paper-input value="{{subjectselectname}}" hidden></paper-input>

          <paper-dropdown-menu id="term" label="Select Acadamic year">
            <paper-menu id="rtermmm" class="dropdown-content"   on-iron-select="FnStoSterm" attr-for-selected="value" required>
                <paper-item value="2015-2016">2015-2016</paper-item>     
                <paper-item value="2016-2017">2016-2017</paper-item>
                <paper-item value="2017-2018">2017-2018</paper-item>
                <paper-item value="2018-2019">2018-2019</paper-item>
                <paper-item value="2019-2020">2019-2020</paper-item>
            </paper-menu>
          </paper-dropdown-menu>
           
      
     
           <paper-dropdown-menu id="grade" label="Select Grade">
            <paper-menu id="rgradewww" class="dropdown-content" on-iron-select="FnStosGrade">     
              <template is="dom-repeat" items="{{selectgradearr}}">
                <paper-item value="{{item.grade_id}}">{{item.grade_name}}</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
         <paper-dropdown-menu  label="Select Section">
            <paper-menu  id="rsectionwww" class="dropdown-content"  on-iron-select="FnStoSSection">
              <template is="dom-repeat" items="{{selectsectionarrr}}">
                <paper-item value="{{item.id}}">{{item.section}}</paper-item>
              </template>   
            </paper-menu>
          </paper-dropdown-menu>  
         </div>

         <div id="tbz1" hidden$="{{hidenewsubcat}}">
    <div class="list-group col-sm-12 panel-body form-category">
      <table class="table table-bordered">
      <!-- <table border="1" class="tt"> -->
        <tbody>
          <tr>
            <td class="outcard"></td>
            <td class="innercard">
              <template is="dom-repeat" items="{{setsubjectarr}}" as="view">
                <h4 style="width:22%; margin-left:5%;">{{view.srtarr}}</h4>   
              </template>
            </td>
            <td class="outcard"></td>
          </tr>   
            <template is="dom-repeat" items="{{bigarr}}" as="view">  
            <tr>
              <td class="outcard">
                <h4>{{view.student_name}}</h4>
              </td>
              <td class="innercard">
                <template is="dom-repeat" items="{{view.subject}}" as="s">
                <student-list-mapping-item id="{{s.id}}" studentname="{{view.student_name}}" studentid="{{view.student_id}}" subjectid="{{s.subject_id}}" subjectname="{{s.subject_name}}"></student-list-mapping-item>
               </template>
               </td>
            </tr>
            </template>
        </tbody>    
      </table>  
    </div>    
    </div>    
     </div>
      <div class="buttons">
        <paper-button style="background-color:black;color:white" on-click="fnsubmit">submit</paper-button>
      </div> 
     
     <iron-ajax  
        auto      
        id="FnSubjecttostudentlanguageajax"
        url="{{FnSubjecttostudentlanguageurl}}"
        params="{{FnSubjecttostudentlanguageparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="FnSubjecttostudentlanguageResponse"
        debounce-duration="300"
        >
         <iron-ajax 
         auto       
        id="FnSubjecttostudentthirdlanguageajax"
        url="{{FnSubjecttostudentthirdlanguageurl}}"
        params="{{FnSubjecttostudentthirdlanguageparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="FnSubjecttostudentthirdlanguageResponse"
        debounce-duration="300"
        >
        <iron-ajax        
        id="SbjecttoStudentmappingajax"
        url="{{SbjecttoStudentmappingurl}}"
        params="{{SbjecttoStudentmappingparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="SbjecttoStudentmappingResponse"
        debounce-duration="300"
        >
  <master-ui-service id="uiservice"></master-ui-service>
  </template>
  <script>
  (function() {
    'use strict';
 var studentarr=[];
    Polymer({      
      is: 'student-to-subject-mapping-card',

    FnStoSterm:function(e)
     {
      this.FnStoStermid=e.target.selectedItem.textContent.trim(); 
       localStorage.setItem("curr_sess_selectedTerms",this.FnStoStermid);
      //alert(this.FnStoStermid);
     },
   
     FnStosGrade:function(e)
     {     
         document.querySelector('#rsectionwww').selected=-1;
         this.FnStosGradeid=e.target.selectedItem.textContent.trim();
         this.FnStosGradeid2=e.target.selectedItem.value;
         localStorage.setItem("curr_sess_selectedgrade",this.FnStosGradeid);
         localStorage.setItem("curr_sess_selectedgrade1",this.FnStosGradeid2);
        // alert(this.FnStosGradeid);
         this.$.uiservice.FnselecttoSection(this.subjectselectid,this.FnStosGradeid);
    
      },  
        f12:function(e){
                this.FnSubjecttostudentlanguageurl=sessionStorage.getItem("addrinfo")+"/FnSubjecttostudentlanguage-service";
            this.$.FnSubjecttostudentlanguageajax.generateRequest();

        },
       f13:function(e){
              this.FnSubjecttostudentthirdlanguageurl=sessionStorage.getItem("addrinfo")+"/FnSubjecttostudentthirdlanguage-service";
            this.$.FnSubjecttostudentthirdlanguageajax.generateRequest();
   
        },
        fnstudent:function(e){
              this.SbjecttoStudentmappingurl=sessionStorage.getItem("addrinfo")+"/SbjecttoStudentmapping-service";
        var obj={"FnStoSSectionid":"","subjectselectid":"","FnStoStermid":"","FnStosGradeid":""};
        obj.FnStoSSectionid=this.FnStoSSectionid;
        obj.subjectselectid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.FnStoStermid=this.FnStoStermid;
        obj.FnStosGradeid=this.FnStosGradeid;
        this.SbjecttoStudentmappingparam=obj;
       alert(JSON.stringify(obj));   
        this.$.SbjecttoStudentmappingajax.generateRequest();
      
        },

     FnStoSSection:function(e)
     {
            this.FnStoSSectionid=e.target.selectedItem.textContent.trim();
            this.FnStoSSectionid1=e.target.selectedItem.value;
            localStorage.setItem("curr_sess_selectedSection",this.FnStoSSectionid);
            localStorage.setItem("curr_sess_selectedSectionvalue1",this.FnStoSSectionid1);
       if(this.FnStosGradeid=="Grade-5"||this.FnStosGradeid=="Grade-6"||this.FnStosGradeid=="Grade-7"||this.FnStosGradeid=="Grade-8"||this.FnStosGradeid=="Grade-9"||this.FnStosGradeid=="Grade-10")
         {
             this.fnstudent();
                  this.f13();
          
          }
         else{
             this.fnstudent(); 
                this.f12();
            
       
         }
     },
     fnsubmit:function(e){
    
     },
     FnSubjecttostudentlanguageResponse:function(e){
       var res=e.detail.response.returnval; 
          
         var setarrr=[];
                 for(var i=0;i<res.length;i++){
                          var subject_name=res[i].subject_name;
                          
                            var obj={"srtarr":""};
                                obj.srtarr=subject_name;
                               setarrr.push(obj);
                              // alert(JSON.stringify(obj));
                          }
               //  alert(JSON.stringify(setarrr));
                   this.setsubjectarr=setarrr;
                var generatearr=[];
                var subarr=[];
                for(var j=0;j<studentarr.length;j++){
                     for(var i=0;i<res.length;i++){
                              var student_id=studentarr[j].id;
                              var student_name=studentarr[j].student_name;
                         
                         var obj={"student_id":"","student_name":"","subject_id":"","subject_name":""}; 
                              var subject_name=res[i].subject_name;
                               var subject_id=res[i].subject_id;
                           obj.student_id=student_id;
                           obj.student_name=student_name;
                           obj.subject_name=subject_name;
                           obj.subject_id=subject_id;
                           generatearr.push(obj);
                        }}//alert(JSON.stringify(generatearr));
        var a=[];
        var overall=[];
       for(var k=0;k<generatearr.length;k++)
       {       
         var nameobj={"student_id":"","student_name":""};
         nameobj.student_name=generatearr[k].student_name; 
         nameobj.student_id=generatearr[k].student_id; 
       
         var obj={"subject_name":"","subject_id":""};
        // obj.Grade_name=generatearr[k].gradename;
        obj.subject_name=generatearr[k].subject_name;
        obj.subject_id=generatearr[k].subject_id;
        obj.id=generatearr[k].subject_id+generatearr[k].student_id;
        a.push(obj);
        for(var l=k+1;l<generatearr.length;l++)
        {
           if(generatearr[k].student_id==generatearr[l].student_id)
           {
            var obj1={"subject_name":"","subject_id":""};
          //obj1.Grade_name=generatearr[l].gradename;
             obj1.subject_name=generatearr[l].subject_name;
             obj1.subject_id=generatearr[l].subject_id;
             obj1.id=generatearr[l].subject_id+generatearr[l].student_id;
           a.push(obj1);
             generatearr.splice(l,1);
             l--;
         }}
           nameobj.subject=a;
           overall.push(nameobj);
           a=[];

       }
      alert(JSON.stringify(overall));
     this.bigarr=overall
     },
     FnSubjecttostudentthirdlanguageResponse:function(e){
         var res=e.detail.response.returnval; 
     var setarrr=[];
                 for(var i=0;i<res.length;i++){
                          var subject_name=res[i].subject_name;
                          
                            var obj={"srtarr":""};
                                obj.srtarr=subject_name;
                               setarrr.push(obj);
                              // alert(JSON.stringify(obj));
                          }
               //  alert(JSON.stringify(setarrr));
                   this.setsubjectarr=setarrr;
                var generatearr=[];
                var subarr=[];
                for(var j=0;j<studentarr.length;j++){
                     for(var i=0;i<res.length;i++){
                              var student_id=studentarr[j].id;
                              var student_name=studentarr[j].student_name;
                         
                         var obj={"student_id":"","student_name":"","subject_id":"","subject_name":""}; 
                              var subject_name=res[i].subject_name;
                               var subject_id=res[i].subject_id;
                           obj.student_id=student_id;
                           obj.student_name=student_name;
                           obj.subject_name=subject_name;
                           obj.subject_id=subject_id;
                           generatearr.push(obj);
                        }}//alert(JSON.stringify(generatearr));
        var a=[];
        var overall=[];
       for(var k=0;k<generatearr.length;k++)
       {       
         var nameobj={"student_id":"","student_name":""};
         nameobj.student_name=generatearr[k].student_name; 
         nameobj.student_id=generatearr[k].student_id; 
       
         var obj={"subject_name":"","subject_id":""};
        // obj.Grade_name=generatearr[k].gradename;
        obj.subject_name=generatearr[k].subject_name;
        obj.subject_id=generatearr[k].subject_id;
        obj.id=generatearr[k].subject_id+generatearr[k].student_id;
        a.push(obj);
        for(var l=k+1;l<generatearr.length;l++)
        {
           if(generatearr[k].student_id==generatearr[l].student_id)
           {
            var obj1={"subject_name":"","subject_id":""};
          //obj1.Grade_name=generatearr[l].gradename;
             obj1.subject_name=generatearr[l].subject_name;
             obj1.subject_id=generatearr[l].subject_id;
             obj1.id=generatearr[l].subject_id+generatearr[l].student_id;
           a.push(obj1);
             generatearr.splice(l,1);
             l--;
         }}
           nameobj.subject=a;
           overall.push(nameobj);
            a=[];
   

       }
          alert(JSON.stringify(overall));
  
this.bigarr=overall;
     },
      SbjecttoStudentmappingResponse:function(e){
          var res=e.detail.response.returnval;
          studentarr=res; 
       alert(JSON.stringify(res));
     },
      
     fnsetreclear:function(e){
     // alert("hi");
      document.querySelector('#rsectionwww').selected=-1;
      document.querySelector('#rtermmm').selected=-1;
      document.querySelector('#rgradewww').selected=-1;
   //   document.querySelector('#rtermmm1').selected=-1;
     
        
     } 
    });
  })();   
  </script>
</dom-module>
