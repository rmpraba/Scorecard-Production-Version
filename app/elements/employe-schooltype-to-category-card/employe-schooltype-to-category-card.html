<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/gold-email-input/gold-email-input.html">
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->
<link rel="import" href="../demosumbit-card/demosumbit-card.html">


<dom-module id="employe-schooltype-to-category-card">
  <template>
    <style>   
      :host {  
        display: block;
      }
    
      .outcard
      {
      width:25% 
      margin-left:2.0em;
      }
       .innercard
       {     
        @apply(--layout-horizontal);
        width:100%
        margin-left:5.5em;
       }
    
     .tt{
      width:70%;
     }
     .newempsubject
      {
        @apply(--layout-horizontal);
        border-radius: 10px;
        border: 1px solid #6699ff;
        padding: 0px;
        width: 64%;
        margin-top: 3%;
        margin-left: 19em;
        min-height: 218px;
      }
       .subbutton 

      {
        background-color: #363636;
        color: #ffffff;                

        height: 3em;
        margin-left: 25em;
        margin-top: 6em;


      }
      
    .language
    {
          margin-left: 28em;
          position: absolute;

          margin-top: 4em;

    }
    .newscrolzz
    {
      overflow-y: scroll;
      overflow-x: hidden;
    }
    #talhidn
    {
          margin-top: 7%;
         margin-left: 3em;

    }
    table
    {
      width: 70%;
      margin-left: 9%;
    }
    #btn1
    {
      margin-left: 50px;

    }
    .scltype1
    {
        @apply(--layout-vertical);
        margin-left: 2em;
    }
    .subcat1
    {
      @apply(--layout-vertical);
      margin-left: 6em;
    }
    </style>
   
      <div>
        <CENTER>
          <h3><b>EMPLOYEE TO SUBJECT MAPPING</b></h3>
        </CENTER>  
      </div>        
        

   <div class="newempsubject">
     <div class="scltype1">
        <div>
          <h4>SCHOOL TYPE</h4>    
        </div>
        <div>
          <template is="dom-repeat" items="{{getschooltypearr}}" as="view">
            <employe-schooltype-to-category-item-card schooltypenamexx="{{view.school_type_name}}" schooltypeidxx="{{view.school_type_id}}" id="EM0S{{view.school_type_id}}"></employe-schooltype-to-category-item-card>
          </template>
        </div>
      </div> 

      <div class="subcat1">  
        <div>  
          <h4>SUBJECT CATEGORY</h4>  
        </div>
        <div>
          <template is="dom-repeat" items="{{getempcategoryarr}}" as="view">
            <employee-category-item-card schooltypecategoryid="{{view.subject_category_id}}" schooltypecategoryname="{{view.subject_category_name}}" id="EM0CAT{{view.subject_category_id}}"></employee-category-item-card>
          </template>
        </div>    
      </div>

      <div class="language">
          <paper-dropdown-menu id="empLanguageprefernce" label="Select The language Type">
            <paper-menu id="empLanguageprefernceid" class="dropdown-content" on-iron-select="empfnselectlanprefercence" attr-for-selected="value" required>
                <paper-item value="coresub">Core Subject</paper-item>
                <paper-item value="2language">Second Language</paper-item>
                <paper-item value="3language">Third Language</paper-item>
            </paper-menu>
          </paper-dropdown-menu>
      </div>

      <div class="subbutton" hidden$="{{hidegenerate}}">
        <paper-button on-click="grnerate">Generate</paper-button>
      </div>
   </div>

     <div id="talhidn" hidden$="{{hidenewgridd}}">
        <!-- <div class="list-group col-sm-12 panel-body form-category"> -->  
          <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse;">
            <!-- <div class="container"> -->
              <!-- <tr>
                <th class="innercard" style=" width: 400px; margin-left:4em;margin-top: -38em">
                  <template is="dom-repeat" items="{{setsubjectarr}}" as="view">
                    <h4 style="padding-left: 50px" >{{view.srtarr}}</h4>
                  </template>
                </th>
                  
              </tr> -->
            <!-- <div class="newscrolzz"> -->
              <template is="dom-repeat" items="{{subjectbigarr}}" as="view">
                <tr style="border-bottom: 1px solid #ccc; line-height: 1.8em;">
                  <td > 
                    <h4>{{view.emp_name}}</h4>   
                  </td>
                  <!-- <td>
                  <table border="1">
                  <tr> -->
                    <template is="dom-repeat" items="{{view.employee}}" as="s">
                        <td><center>
                        <employe-creation-card hideinput="{{s.hideinput}}" hidecheck="{{s.hidecheck}}" employeesetidz="{{view.emp_id}}" id="{{s.id}}" subjectname="{{s.subject_name}}" empsubjectname="{{s.subject_id}}"  empnames="{{view.emp_name}}"  emplanpreff="{{emplangprefernce}}"></employe-creation-card>
                        </center>
                        </td>
                    </template>   
                  <!-- </tr>
                  </table> 

                  </td> -->
                  <td>
                    <paper-icon-button  id="btn1" icon="save" on-click="FnSubmit"></paper-icon-button>
                    <paper-tooltip for="btn1">Save</paper-tooltip>
                  </td>
                  <td>
                    <paper-icon-button  id="btn2" icon="close" on-click="Fndelte"></paper-icon-button>
                    <paper-tooltip for="btn2">Delete</paper-tooltip>
                  </td>          
                </tr>    
                <!-- <tr><hr/></tr> -->
              </template>
            <!-- </div> -->
          </table>   
        </div>  
        
      
    <demosumbit-card id="mydialog"></demosumbit-card>
    
  <master-ui-service id="uiservice"></master-ui-service>      
</template>
          <script>
  (function() {
    'use strict';
     var empteacharr=[];
     var getcategory=[];
     var getgradenames=[];
     var namearr=[];
     var setspecificarr=[];
     var bigarrz=[];
     var deldbarrs=[];
     var overall1=[];
   
    Polymer({
      is: 'employe-schooltype-to-category-card',
      fnempsubject:function(){
        this.$.talhidn.hidden=true;
        this.$.empLanguageprefernce.hidden=true;
        this.hidegenerate=true;
    },
    FnRefresh:function()
    {
      this.$.empLanguageprefernce.hidden=true;
      if(document.querySelector('#empLanguageprefernceid').selected!=-1)

      {
        document.querySelector('#empLanguageprefernceid').selected=-1;
      }
    },
    
       getgrade:function(arr){
        empteacharr=arr;
        //emparr=arr;

        
       },
       langprefere:function(e)
       {
        //   alert('1');
          if(sessionStorage.getItem("curr_sess_loggedschoolcategory_id")=='category1')
          {
                  this.$.empLanguageprefernce.hidden=false;
                  
          }
          else
          {

              this.$.empLanguageprefernce.hidden=true;
              this.hidegenerate=false;
              var empty='empty';
              document.querySelector('employee-category-item-card').fnsetemployeelanprefer(empty);
              document.querySelector('#empLanguageprefernceid').selected=-1;
          }   
        },
        clean:function(e){
        this.$.empLanguageprefernce.hidden=true;
        this.hidegenerate=true;
      },
       getcategory:function(arr){

       getcategory=arr;
       },
       getemployeegrade:function(arr){
        empgradearr=arr;
      },
      passempgrade:function(arr){
       getgradenames=arr;
      },
      autocompletename:function(nameitem){
          namearr=nameitem;
      },
      empfnselectlanprefercence:function(e)
      {
        this.emplangprefernce=e.target.selectedItem.textContent.trim();
        this.hidegenerate=false;
        document.querySelector('employee-category-item-card').fnsetemployeelanprefer(this.emplangprefernce);
         
      },
     
    deldbarr:function(arr){  
       deldbarrs=arr;  
    },
      FnSubmit:function(e){
      //  alert(JSON.stringify(getgradenames));
        this.$.uiservice.fnempsubjectdetails(getgradenames);
        document.querySelector('employe-creation-card').fnnewsave();
        //this.$.mydialog.toggleDialog();
       document.querySelector('employe-creation-card').Fnsubjectclean(); 
       
       },
       Fndelte:function(e){
      // alert(JSON.stringify(deldbarrs));
        this.$.uiservice.fnemployeeedelfn(deldbarrs);
        this.$.mydialog.toggleDialog1();
       document.querySelector('employe-creation-card').Fnsubjectdelclean();        
       
       },
      

        grnerate:function(e)
        {
          //document.querySelector('employe-creation-card').Fnsubjectclean(); 
          //document.querySelector('#empLanguageprefernceid').selected=-1;   
         
            if(overall1!=0){
             // alert('1');
          document.querySelector('employe-creation-card').Fnsubjectclean1();

            }
            //alert(JSON.stringify(getcategory));
            //alert(JSON.stringify(empteacharr));
            var setarrr=[];
                 for(var i=0;i<getcategory.length;i++)
                 {
                          var subject_name=getcategory[i].subject_name;
                          
                            var obj={"srtarr":""};
                                obj.srtarr=subject_name;
                               setarrr.push(obj);
                  }

                 
                   // this.setsubjectarr=setarrr;

                  var generatearr=[];
                 var subarr=[];
                for(var j=0;j<empteacharr.length;j++)
                {
                     for(var i=0;i<getcategory.length;i++)
                     {
                        var emp_name=empteacharr[j].emp_name;
                        var emp_id=empteacharr[j].emp_id;
                         
                         var obj={"emp_name":"","subject_name":"","subject_id":"","emp_id":""}; 
                           var subjectname=getcategory[i].subject_name;
                           var subject_id=getcategory[i].subject_id;
                           obj.emp_id=emp_id;
                           obj.subject_name=subjectname;
                           obj.emp_name=emp_name;
                           obj.subject_id=subject_id;
                           generatearr.push(obj);
                      }
                }
                  var a=[];
                  var overall=[];
               for(var k=0;k<generatearr.length;k++)
               {       
                 var nameobj={"emp_name":"","emp_id":""};
                 nameobj.emp_name=generatearr[k].emp_name; 
                 nameobj.emp_id=generatearr[k].emp_id; 
               
                     var obj={"subject_name":"","subject_id":""};
                    obj.subject_name=generatearr[k].subject_name;
                    obj.subject_id=generatearr[k].subject_id;
                    obj.id=generatearr[k].subject_id+generatearr[k].emp_id;
                    a.push(obj);
                    for(var l=k+1;l<generatearr.length;l++)
                    {
                       if(generatearr[k].emp_id==generatearr[l].emp_id)
                       {
                         var obj1={"subject_name":"","subject_id":""}
                         obj1.subject_name=generatearr[l].subject_name;
                         obj1.subject_id=generatearr[l].subject_id;
                         obj1.id=generatearr[l].subject_id+generatearr[k].emp_id;
                         a.push(obj1);
                         generatearr.splice(l,1);
                         l--;
                        }
                    }
                   nameobj.employee=a;
                   overall.push(nameobj);
                   overall1.push(nameobj);
                   a=[];
                }

          var temp=[];
          var subarr=[];
          var obj={};
          obj.emp_name="";
          obj.emp_id="id";
          for(var i=0;i<(setarrr).length;i++){
          var obj1={};
          obj1.subject_name=setarrr[i].srtarr;
          obj1.hideinput=false;
          obj1.hidecheck=true;          
          subarr.push(obj1);
          }
          obj.employee=subarr;
          temp.push(obj);

         this.finalarr=[];
         this.finalarr.push(temp[0]);
         for(var i=0;i<(overall).length;i++){
          for(var j=0;j<(overall[i].employee).length;j++){
            overall[i].employee[j].emp_id=overall[i].emp_id;
            if(j==0)
            overall[i].employee[j].emp_name=overall[i].emp_name;
            else
            overall[i].employee[j].emp_name="";
            overall[i].employee[j].hideinput=true;
            overall[i].employee[j].hidecheck=false;
          }
          this.finalarr.push(overall[i]);
         }
         this.subjectbigarr=this.finalarr;
                 // this.subjectbigarr=overall;
                 // alert(JSON.stringify(this.finalarr));
                  //  setspecificarr=overall;
                       this.schooltypeid=sessionStorage.getItem("curr_sess_loggedschooltype_ids");
                        this.categoryid=sessionStorage.getItem("curr_sess_loggedschoolcategory_id");
                this.$.uiservice.fngetempsubject(this.schooltypeid,this.categoryid,this.emplangprefernce);
                    
                 overall.splice();
                 generatearr=[];
                // this.$.uiservice.fngetThefunction();
                   //this.$.subbutton1.hidden=false;
                   this.$.talhidn.hidden=false;
                   //this.$.empidz1.hidden=false;
                           
          },
          
         
           fnndialogg:function()
          {
            //alert("saveee");
            this.$.mydialog.toggleDialog();
          },
          fnninput:function()
          {
            //alert("no input");
            this.$.mydialog.toggleDialog3();
          }
    
    

     });
  })();
  </script>
</dom-module>
