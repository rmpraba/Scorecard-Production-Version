<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/gold-email-input/gold-email-input.html">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
   <!-- Jquery -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<link rel="import" href="../demosumbit-card/demosumbit-card.html">


<dom-module id="employe-schooltype-to-category-card">
  <template>
    <style>  
      :host {  
        display: block;
      }
     .card1{
        margin-left:5%;
        margin-top: 4%;
      }
      .card2{     
        margin-left:40%;    
         margin-top:-17%;
      }
      .outcard{
      width:25% 
     margin-left:2.0em;
      }
       .innercard
       {     
        @apply(--layout-horizontal);
        width:100%
        margin-left:5.5em;
       }
    
     .tt{
      width:70%;
     }
     .outercard
      {
        border-radius: 10px;
        border: 2px solid #6699ff;
        padding: 0px;
        margin-top: 3%;
        width: 80%;
        margin-left: 10%;
        min-height: 330px;
      }
       .subbutton paper-button
      {
        @apply(--layout-right);
        background-color: #363636;
        color: #ffffff;                
        width: 17%;
        margin-left: 80%;
        margin-top: 8%;
      }
      
    .subcat1
      {
        margin-left: 36%;
      }
    .language
    {
      @apply(--layout-horizontal);
          margin-left: 55%;
          position: absolute;
          top: 38%;
    }
    .newwwwcardd
    {
      overflow-y: scroll;
      overflow-x: hidden;
    }
    #talhidn
    {
      margin-top: 2%;
    }
    table
    {
      width: 70%;
    }

    </style>
   
      <div>
        <CENTER>
          <h3><b>EMPLOYEE TO SUBJECT MAPPING</b></h3>
        </CENTER>  
      </div>      
     
     <div>   
       <div class="outercard">
            <div class="col-sm-4" style="margin-top: 4%;">
              <div class="form-group-heading">
                <h4>SCHOOL TYPE</h4>    
              </div>
               <template is="dom-repeat" items="{{getschooltypearr}}" as="view">
                <employe-schooltype-to-category-item-card schooltypenamexx="{{view.school_type_name}}" schooltypeidxx="{{view.school_type_id}}" id="EM0S{{view.school_type_id}}"></employe-schooltype-to-category-item-card>
              </template>
              </div>  
          <div class="subcat1" style="margin-top: 5%;">
              <div class="form-group-heading">  
                <h4>SUBJECT CATEGORY</h4>  
              </div>
              <template is="dom-repeat" items="{{getempcategoryarr}}" as="view">
                <employee-category-item-card schooltypecategoryid="{{view.subject_category_id}}" schooltypecategoryname="{{view.subject_category_name}}" id="EM0CAT{{view.subject_category_id}}"></employee-category-item-card>
              </template>
          </div>   

          <div class="language">
            <paper-dropdown-menu id="empLanguageprefernce" label="Select The language Type">
               <paper-menu id="empLanguageprefernceid" class="dropdown-content" on-iron-select="empfnselectlanprefercence" attr-for-selected="value" required>
                 <paper-item value="coresub">Core Subject</paper-item>
                 <paper-item value="2language">Second Language</paper-item>
                 <paper-item value="3language">Third Language</paper-item>
             </paper-menu>
            </paper-dropdown-menu>
          </div>

           <div class="subbutton">
              <paper-button on-click="grnerate">Generate</paper-button>
           </div>
           

         </div>
     </div>
  

     <div id="talhidn" hidden$="{{hidenewgridd}}">
        <!-- <div class="list-group col-sm-12 panel-body form-category"> -->  
        <div>
          <table class="table table-bordered">
            <!-- <div class="container"> -->
            <div>
              <thead> 
              <tr>
                  <th class="innercard" style="width: 700px;margin-left: 15%;">
                    <template is="dom-repeat" items="{{setsubjectarr}}" as="view">
                      <h4>{{view.srtarr}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h4>
                    </template>
                  </th>
                  <!-- <th class="icheadd">
                    <th>Save</th>
                    <th>Delete</th>
                  </th>  -->  
                    
               </tr>
              </thead>
                <tbody class="newwwwcardd col-sm-12" style="width: 1070px;height: 350px;">
               <tr>
                 <td></td>
                 <td></td>
                <!--  <td>Save</td>
                 <td>Delete</td> -->
         
               </tr>
                <template is="dom-repeat" items="{{subjectbigarr}}" as="view">
                <tr>
                  <td class="outcard"> 
                    <h4>{{view.emp_name}}</h4>   
                    </td>
                    <td class="innercard" style="width: 770px;">
                      <template is="dom-repeat" items="{{view.employee}}" as="s">
                        <employe-creation-card employeesetidz="{{view.emp_id}}" id="{{s.id}}" empsubjectname="{{s.subject_id}}"  empnames="{{view.emp_name}}"  emplanpreff="{{emplangprefernce}}"></employe-creation-card>
                      </template>   
                  </td>
                  <td>
                    <paper-icon-button  id="btn1" icon="save" on-click="FnSubmit"></paper-icon-button>
                    <paper-tooltip for="btn1">Save</paper-tooltip>
                 </td>
                  <td>
                    <paper-icon-button  id="btn2" icon="close" on-click="Fndelte"></paper-icon-button>
                    <paper-tooltip for="btn2">Delete</paper-tooltip>
                 </td>          
                </tr>
                </template>
              </tbody>
            </div>
          </table>   
        </div>   
        </div>  
        
      
    <demosumbit-card id="mydialog"></demosumbit-card>
    
  <master-ui-service id="uiservice"></master-ui-service>      
</template>
          <script>
  (function() {
    'use strict';
     var empteacharr=[];
     var getcategory=[];
     var getgradenames=[];
     var namearr=[];
     var setspecificarr=[];
     var bigarrz=[];
     var deldbarrs=[];
     var overall1=[];
   
    Polymer({
      is: 'employe-schooltype-to-category-card',
      ready:function(){
        //this.$.subbutton1.hidden=true;
        this.$.talhidn.hidden=true;
        //this.$.empidz1.hidden=true;
       // this.$.empidz.hidden=true;
     
        //this.$.generateidz.hidden=true;
        this.$.empLanguageprefernce.hidden=true;
    },
    FnRefresh:function()
    {
      this.$.empLanguageprefernce.hidden=true;
      //document.querySelector('#empLanguageprefernceid').selected=-1;
    },
    fnbuttonsclean:function()
    {
     //this.$.empidz1.hidden=true; 
     //this.$.subbutton1.hidden=true;
    },
       getgrade:function(arr){
        empteacharr=arr;
        //emparr=arr;

        
       },
       langprefere:function(e)
       {
        //   alert('1');
          if(sessionStorage.getItem("curr_sess_loggedschoolcategory_id")=='category1')
          {
                  this.$.empLanguageprefernce.hidden=false;
          }
          else
          {

              this.$.empLanguageprefernce.hidden=true;
              var empty='empty';
              document.querySelector('employee-category-item-card').fnsetemployeelanprefer(empty);
              document.querySelector('#empLanguageprefernceid').selected=-1;
          }   
        },
        clean:function(e){
        this.$.empLanguageprefernce.hidden=true;
      },
       getcategory:function(arr){

       getcategory=arr;
       },
       getemployeegrade:function(arr){
        empgradearr=arr;
      },
      passempgrade:function(arr){
       getgradenames=arr;
      },
      autocompletename:function(nameitem){
          namearr=nameitem;
      },
      empfnselectlanprefercence:function(e){
        this.emplangprefernce=e.target.selectedItem.textContent.trim();
        document.querySelector('employee-category-item-card').fnsetemployeelanprefer(this.emplangprefernce);
         
      },
     
    deldbarr:function(arr){  
       deldbarrs=arr;  
    },
      FnSubmit:function(e){
      //  alert(JSON.stringify(getgradenames));
        this.$.uiservice.fnempsubjectdetails(getgradenames);
        this.$.mydialog.toggleDialog();
       document.querySelector('employe-creation-card').Fnsubjectclean(); 
       
       },
       Fndelte:function(e){
      // alert(JSON.stringify(deldbarrs));
        this.$.uiservice.fnemployeeedelfn(deldbarrs);
        this.$.mydialog.toggleDialog1();
       document.querySelector('employe-creation-card').Fnsubjectdelclean();        
       
       },
      

        grnerate:function(e)
        {
          //document.querySelector('employe-creation-card').Fnsubjectclean(); 
          //document.querySelector('#empLanguageprefernceid').selected=-1;       
            if(overall1!=0){
             // alert('1');
          document.querySelector('employe-creation-card').Fnsubjectclean1();

            }
            //alert(JSON.stringify(getcategory));
            //alert(JSON.stringify(empteacharr));
            var setarrr=[];
                 for(var i=0;i<getcategory.length;i++)
                 {
                          var subject_name=getcategory[i].subject_name;
                          
                            var obj={"srtarr":""};
                                obj.srtarr=subject_name;
                               setarrr.push(obj);
                  }

                 
                   this.setsubjectarr=setarrr;

                  var generatearr=[];
                 var subarr=[];
                for(var j=0;j<empteacharr.length;j++)
                {
                     for(var i=0;i<getcategory.length;i++)
                     {
                        var emp_name=empteacharr[j].emp_name;
                        var emp_id=empteacharr[j].emp_id;
                         
                         var obj={"emp_name":"","subject_name":"","subject_id":"","emp_id":""}; 
                           var subjectname=getcategory[i].subject_name;
                           var subject_id=getcategory[i].subject_id;
                           obj.emp_id=emp_id;
                           obj.subject_name=subjectname;
                           obj.emp_name=emp_name;
                           obj.subject_id=subject_id;
                           generatearr.push(obj);
                      }
                }
                  var a=[];
                  var overall=[];
               for(var k=0;k<generatearr.length;k++)
               {       
                 var nameobj={"emp_name":"","emp_id":""};
                 nameobj.emp_name=generatearr[k].emp_name; 
                 nameobj.emp_id=generatearr[k].emp_id; 
               
                     var obj={"subject_name":"","subject_id":""};
                    obj.subject_name=generatearr[k].subject_name;
                    obj.subject_id=generatearr[k].subject_id;
                    obj.id=generatearr[k].subject_id+generatearr[k].emp_id;
                    a.push(obj);
                    for(var l=k+1;l<generatearr.length;l++)
                    {
                       if(generatearr[k].emp_id==generatearr[l].emp_id)
                       {
                         var obj1={"subject_name":"","subject_id":""}
                         obj1.subject_name=generatearr[l].subject_name;
                         obj1.subject_id=generatearr[l].subject_id;
                         obj1.id=generatearr[l].subject_id+generatearr[k].emp_id;
                         a.push(obj1);
                         generatearr.splice(l,1);
                         l--;
                        }
                    }
                   nameobj.employee=a;
                   overall.push(nameobj);
                   overall1.push(nameobj);
                   a=[];
                }
                 this.subjectbigarr=overall;
                  //  setspecificarr=overall;
                       this.schooltypeid=sessionStorage.getItem("curr_sess_loggedschooltype_ids");
                        this.categoryid=sessionStorage.getItem("curr_sess_loggedschoolcategory_id");
                this.$.uiservice.fngetempsubject(this.schooltypeid,this.categoryid,this.emplangprefernce);
                    
                 overall.splice();
                 generatearr=[];
                // this.$.uiservice.fngetThefunction();
                   //this.$.subbutton1.hidden=false;
                   this.$.talhidn.hidden=false;
                   //this.$.empidz1.hidden=false;
                           
          },
          

    

     });
  })();
  </script>
</dom-module>
