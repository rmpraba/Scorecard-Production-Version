<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="../demosumbit-card/demosumbit-card.html">

<dom-module id="employe-category-creation-card">
  <template>
   <style>    
      :host {  
        display: block;
      }  
       
      .outercard
      {
        @apply(--layout-vertical);
      }
      
     .outercard
      {
        border-radius: 10px;
        border: 2px solid #6699ff;
        padding: 20px;
        margin-top: 6%;
        width: 48%;
        margin-left: 28%;
        min-height: 300px;
      }
      .subbutton paper-button
      {
        /*@apply(--layout-right);*/
        float: none;
        background-color: #363636;
        color: #ffffff;                
        width: 8%;
        margin-left: 43%;
        margin-top: 4%;
      }
        .deltbutton paper-button
      {
        /*@apply(--layout-right);*/
        float: left;
        background-color: #363636;
        color: #ffffff;                
        width: 8%;
        margin-left: 52%;
        margin-top: -3%;
      }
        .subbutton1 paper-button
      {
        @apply(--layout-right);
        background-color: #363636;
        color: #ffffff;                
        width: 8%;
        margin-left: 65%;
        margin-top: 4%;
      }
     
      .newcard
      {
        @apply(--layout-horizontal);
        width: 250%;
        margin-left: 24%;
        margin-top: -12%;
      }
       paper-dropdown-menu
       {
        /*width: 260%;*/
        margin-left: 8%;
        /*--paper-input-container-label: { color: red };*/
        text-align:center;
       }
       .catcard
       {
        @apply(--layout-center);
        margin-top: 5%;
       }
       .innercard{     
      @apply(--layout-horizontal);
       width:100%
      margin-left:2.5em;
     }
     
         .innercard1{     
      @apply(--layout-horizontal);
       width:100%
      margin-left:5.0em;
     }
   
    </style>


    <div>
      <CENTER>
        <h3><b>EMPLOYEE TO GRADE SECTION MAPPING</b></h3>
      </CENTER>
    </div>

    <div>
      <div class="outercard">
        <table>
          <div>  
          <div class="catcard">   
            <label>School Type</label>
            <template is="dom-repeat" items="{{empschoolarr}}" as="view">
              <emp-category-get-card empschooltypeids="{{view.school_type_name}}" empschoolnames="{{view.school_type_id}}" id="EMSEC{{view.school_type_id}}"></emp-category-get-card>
            </template>   
          </div>     
    
            <div class="newcard">
              <paper-dropdown-menu  label="Select the Employee">
                <paper-menu id="employeeidzzzzzz" class="dropdown-content"   on-iron-select="fnemployeename">
                  <template is="dom-repeat" items="{{empschoolnamesarr}}">
                    <paper-item value="{{item.emp_id}}">{{item.emp_name}}</paper-item>
                  </template>    
                </paper-menu>
              </paper-dropdown-menu>
            </div>  
       
          </div>  
        </table>
      </div>
   
      <div id="newwgridd">
        <table class="table table-bordered">
          <tbody>
            <tr>
              <th><h4><b>Grade</b></h4></th>
              <th><h4><b>Subject</b></h4></th>
              <th><center><h4><b>Select Section Name</b></h4></center></th>
              <th><h4><b>Save</b></h4></th>  
              <th><h4><b>Delete</b></h4></th>
            </tr>
              
            <template is="dom-repeat" items="{{allarrr}}" as="view">
              <tr>
                <td></td>
                <td></td>
                <td class="innercard1">
                  <template is="dom-repeat" items="{{view.head}}" as="s">
                    <h4 style="margin-left:6%">{{s.section_id}}</h4>
                  </template>
                </td>
                <td></td>  
                <td></td>
              </tr>
              
              <template is="dom-repeat" items="{{view.busvalue}}" as="s">
                <tr>
                  <td class="outcard"> 
                    <h4>{{view.gradename1}}</h4>
                  </td>
                  <td class="outcard"> 
                    <h4>{{s.subname}}</h4>
                  </td>
                  <td class="innercard">
                    <template is="dom-repeat" items="{{s.subject}}" as="m">
                      <emp-grade-get-card employeesectionidz="{{m.class_id}}" id="{{s.subname1}}{{m.class_id}}"   empsubjectidz="{{s.subname1}}" employeesectionnamez="{{m.section_id}}" employeeidz="{{empselectid}}" empgradeidz="{{view.gradename}}" >
                      </emp-grade-get-card>
                    </template>
                  </td>
                 
                  <td>
                    <paper-icon-button id="btnn1" icon='save' on-click='fnsubmit'></paper-icon-button>
                    <paper-tooltip for="btnn1">Save</paper-tooltip>
                  </td>
                  <td>
                    <paper-icon-button id="btn2" icon='close' on-click='fndelete'></paper-icon-button>
                    <paper-tooltip for="btn2">Delete</paper-tooltip>
                  </td>
                </tr>
              </template>
              
            </template>
          </tbody>
        </table>
      </div>
        
  
   <demosumbit-card id="mydialog"></demosumbit-card>
    <master-ui-service id="uiservice"></master-ui-service>
 
<iron-ajax        
        id="fnselectgradezajax"
        url="{{fnselectgradezurl}}"
        params="{{fnselectgradezparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="fnselectgradezResponse"
        debounce-duration="300">
   </iron-ajax>
   <iron-ajax        
        id="fnemployeenamezajax"
        url="{{fnemployeenamezurl}}"
        params="{{fnemployeenamezparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="fnemployeenamezResponse"
        debounce-duration="300">
   </iron-ajax>
 
  </template>
  <script>
  (function() {
    'use strict';
  var empnamearrr=[];
  var sectionnamearr=[];
  var empsectionarr=[];
  var empsectionarr1=[];
  var sectionnamearr1=[];
  var overall11=[];
  
    Polymer({
      is: 'employe-category-creation-card',
      ready:function(e){
     this.$.newwgridd.hidden=true;
       
      },
      FnRefresh:function()
      {
        document.querySelector('#empgradeid').selected=-1;
        document.querySelector('#employeeidzzzzzz').selected=-1;
        //document.querySelector('emp-category-get-card').FnRefresh();
      },
      fncleanbutton:function()
      {
        //this.$.subx.hidden=true;
        //this.$.subx1.hidden=true;
      },
        fnschoolempnames:function(arr){
           //  alert(JSON.stringify(arr));
             this.empschoolnamesarr=arr;
         //    alert("1");
      },  
        fnschoolempnames:function(arr)
        {
          this.empschoolnamesarr=arr;
        },  
        fnschoolempgrade:function(arr){
          //alert(JSON.stringify(arr));
           sectionnamearr1=arr;
            

         },
        fnselectgrade:function(e){
      this.fnselectgradezurl=sessionStorage.getItem("addrinfo")+"/tranfersection-service";
          var obj={"setgradeid":"","school_id":"","academic_year":""};
          obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
          obj.setgradeid=this.setgradeid;
          obj.academic_year=localStorage.getItem("curr_sess_academicyear");
          this.fnselectgradezparam=obj;
          //alert(JSON.stringify(obj));
          this.$.fnselectgradezajax.generateRequest();
          document.querySelector('#employeeidzzzzzz').selected=-1;
      
      },
      fnselectgradezResponse:function(e){
               sectionnamearr=e.detail.response.returnval;
     },
     fnsubmit:function(e){
     
         this.$.uiservice.fnsavesection(empsectionarr);
         this.$.mydialog.toggleDialog();
         document.querySelector('emp-grade-get-card').Fngradecleansection(); 
        },      
       fndelete:function(e){ 
      this.$.uiservice.fndelsectionz(empsectionarr1);
      this.$.mydialog.toggleDialog1();
      document.querySelector('emp-grade-get-card').Fngradecleansection1(); 
      
     },
     fnsetempsection:function(arr)
     {
      empsectionarr=arr;
     //alert(JSON.stringify(empsectionarr));
     },
       fnsetempsection1:function(arr){
      empsectionarr1=arr;
  //    alert(JSON.stringify(empsectionarr));
    },
  
       f11:function(e){
          this.fnemployeenamezurl=sessionStorage.getItem("addrinfo")+"/empmappingsubject-service";
          var obj={"empselectid":"","school_id":""};
          obj.empselectid=this.empselectid;
          obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
          this.fnemployeenamezparam=obj;
          //alert(JSON.stringify(obj));
          this.$.fnemployeenamezajax.generateRequest();
       
        },
        f12:function(e){
        document.querySelector('emp-category-get-card').f1(); 
     },
  
       
    fnemployeename:function(e)
    {  
       this.empselectid=e.target.selectedItem.value;
       this.$.newwgridd.hidden=false;
       this.f12();
        this.f11();  
        },
     
      fnemployeenamezResponse:function(e){
      empnamearrr=e.detail.response.returnval;
     // alert(JSON.stringify(sectionnamearr1));
     // alert(JSON.stringify(empnamearrr));
   /*    var setarr=[];
                 for(var i=0;i<sectionnamearr1.length;i++){
                          var section_name=sectionnamearr1[i].section;
                            var obj={"subjectarr":""};
                                obj.subjectarr=section_name;
                               setarr.push(obj);
                          }
                 this.setsectionname=setarr;

   */  
      if(overall11!=0){   
     document.querySelector('emp-grade-get-card').Fngradecleansection2(); 
       
        }
          var generatearr=[];
        var a=[];
        var overall=[];
       for(var k=0;k<sectionnamearr1.length;k++)
       {       
         var nameobj={"grade_id":"","grade_name":""};
         nameobj.grade_id=sectionnamearr1[k].grade_id; 
         nameobj.grade_name=sectionnamearr1[k].grade_name; 
          var obj={"section_id":"","class_id":""};
        obj.section_id=sectionnamearr1[k].section_id;
        obj.class_id=sectionnamearr1[k].class_id;
        a.push(obj);
        for(var l=k+1;l<sectionnamearr1.length;l++)
        {
           if(sectionnamearr1[k].grade_id==sectionnamearr1[l].grade_id)
           {
         var obj1={"section_id":"","class_id":""}
             obj1.section_id=sectionnamearr1[l].section_id;
             obj1.class_id=sectionnamearr1[l].class_id;
             a.push(obj1);
             sectionnamearr1.splice(l,1);
             l--;
         }}
            nameobj.subject=a;
            nameobj.head=a;
         
           overall.push(nameobj);
          
          a=[];
       }
       // alert(JSON.stringify(overall));
         var aoo=[];
          for(var j=0;j<overall.length;j++){
            for(var i=0;i<empnamearrr.length;i++){
      
              var obj={"gradename":"","gradename1":"","subname":"","subname1":"","subject":"","head":""};
                  obj.subname=empnamearrr[i].subject;
                   obj.subname1=empnamearrr[i].subjectid;
            
                  obj.gradename=overall[j].grade_id;
                  obj.gradename1=overall[j].grade_name;
                  obj.subject=overall[j].subject;
                  obj.head=overall[j].head;
                   aoo.push(obj);
                
               }

       };
              
        var a1=[];
        var overall1=[];
       for(var k=0;k<aoo.length;k++)
       {       
         var nameobj={"gradename1":"","gradename":"","head":""};
         nameobj.gradename=aoo[k].gradename; 
         nameobj.gradename1=aoo[k].gradename1; 
         nameobj.head=aoo[k].head; 
      
        var obj={"subname1":"","subname":"","subject":""};
         obj.subname=aoo[k].subname;
         obj.subject=aoo[k].subject;
         obj.subname1=aoo[k].subname1;
        a1.push(obj);
        for(var l=k+1;l<aoo.length;l++)
        {
           if(aoo[k].gradename==aoo[l].gradename)
           {
         var obj1={"subname1":"","subname":"","subject":""}
             obj1.subname1=aoo[l].subname1;
             obj1.subname=aoo[l].subname;
             obj1.subject=aoo[l].subject;
             a1.push(obj1);
             aoo.splice(l,1);
             l--;
         }}
            nameobj.busvalue=a1;
         
           overall1.push(nameobj);
           overall11.push(nameobj);
          a1=[];
        }
       // alert(JSON.stringify(overall1));
        this.allarrr=overall1;
        this.$.uiservice.empgetsectionvalues(this.empselectid);
      }

       });
      
      })();
  </script>
</dom-module>
