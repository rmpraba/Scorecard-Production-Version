

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu-light/paper-dropdown-menu-light.html">


<dom-module id="subject-card">
  <template>
    <style>   
      :host
      {
         margin-left: 10%;
        display: block;
         @apply(--layout-center);
        /*width: 40%;*/
      }

      .card
      {  
         @apply(--layout-center);
        width: 80%;
        margin-left: 10%;
      }
      .headdiv
      {
        width: 200%;  
      }

      .title
      {
        @apply(--layout-center);
        width: 255%;
        margin-left: 35%;     
      }

      .creatediv paper-button
      {
      background-color: #363636;
      color: #ffffff;
      width: 6%;
      margin-left: 61%;
      margin-top: 3%;
      }

      .buttons paper-button
      {
        @apply(--layout-center);
      background-color: #363636;
      color: #ffffff;
      width: 10%;
      margin-top: 6%;
      }

      .popup-btn
      {
        margin: 0 auto;
        margin-left: 63%;
      }

      table
      {
        @apply(--layout-horizontal);
         /*border-collapse: collapse;
        border: 1px solid #dedede;*/
        margin-left: 40%;
        margin-top: 1%;
        width: 65%;
      }
      /*.outcard
      {
        @apply(--layout-horizontal);
      }
*/
      .creatediv
      {
          /*border-radius: 10px;
          border: 1px solid #6699ff;
          padding: 10px; */
         /* width: 28%;
          top: 24% !important;
          margin-left: 4%;
          max-height: 330px;*/

          width: 28%;
          position: fixed;
          top: 24% !important;
          margin-left: 4%;
          max-height: 330px;
      }
      .newwwww
      {
        line-height: 4px;
        margin-top: 4%;
      }

         .vertical-row 
      {
             position: absolute;
            border: 1px solid #12A5F4;
            width: 1px;
            margin-left: 34%;
            top: 17%;
            min-height: 1700px;
          /* margin-top: -111% !important; */
      } 
     

    </style>


    <div class="title"> 
        <h3><b>SUBJECTS</b></h3>
    </div>

   <div class="outcard">
    
    <div>
      <table>
        <tr>
           <h4> <label style="margin-left: 56%; line-height: 2px;"><b>Currently Available Subjects</label></b></label></h4>
            <th><label style="margin-left:8%">Subject Names</label></h4></th>
            <th> <label style="margin-left:-1%">Category Type</label>
            <th><paper-icon-button id="btn1" icon="add" on-click="getsubjectname"></paper-icon-button>
            <paper-tooltip for="btn1">Create</paper-tooltip>
            </th>
            <th></th>
        </tr>

        <template is="dom-repeat" items="{{subarr}}" as="sb">
            <tr><td colspan="4">
             <subject-display-card subjectid="{{sb.subject_id}}" subjectname="{{sb.subject_name}}" subjectcategory="{{sb.category}}" hidesubjectinput="true" hidesubjectitem="false">
            </subject-display-card></td>
            </tr>
        </template>
      </table>
    </div>

    <div class="vertical-row" style="position: fixed;"></div>

    <div class="creatediv" hidden$="{{hidenewsubjectzz}}">
        <div class="card">    
          <div class="headdiv">
              <h4><label><b>Create New Subject</b></label></h4>
          </div>   
            
            <paper-input hidden value="{{subjectid}}" label="Subject ID"></paper-input>
            <paper-input label="Subject Name"  required error-message="needs Subject name!" value="{{subjectname}}"  allowed-pattern="[a-zA-Z ]" ></paper-input>

            <paper-dropdown-menu id="subcat" label="Select Category Type">
              <paper-menu  id="category" class="dropdown-content" on-iron-select="FnSelectCategoryzzz">
                <template is="dom-repeat" items="{{categoryarr}}" as="view">
                  <paper-item value="{{view.category_type}}">{{view.category_name}}</paper-item>        
                </template>
              </paper-menu>
            </paper-dropdown-menu> 
            <paper-dropdown-menu id="Languageprefernce" label="Select The language Type">
            <paper-menu id="Languageprefernceid" class="dropdown-content" on-iron-select="fnselectlanprefercence" attr-for-selected="value" required>
                 <paper-item value="coresub">Core Subject</paper-item>
                 <paper-item value="2language">Second Language</paper-item>
                 <paper-item value="3language">Third Language</paper-item>
            </paper-menu>
       </paper-dropdown-menu>
                </div>   
        <div class="buttons">
              <paper-button class="popup-btn" on-click="FnSubmit">Submit</paper-button>
            </div>
      </div>
    </div> 


              <paper-dialog id="newsubmitbox" modal>
                  <label>Inserted Successfully !!!</label>
                  <div class="buttons">
                    <paper-button dialog-confirm autofocus on-click="Fnclose">Close</paper-button>
                  </div>
              </paper-dialog> 

      <master-ui-service id="uiservice"></master-ui-service>
     
   </template>

   <script>
  (function() {
    'use strict';
     var category;
     var subname="";
    Polymer
    ({
      is: 'subject-card',

      ready:function()
      {
       // alert("hi");
        this.$.uiservice.category1();   
        this.$.uiservice.FnFetchSubjectSeq();
        this.$.uiservice.FnFetchSubjectname();
        this.$.hidenewssubjectcard=true; 
        this.$.Languageprefernce.hidden=true;    
      },
      
      FnRefresh:function()
      {
       document.querySelector('#category').selected=-1;
       this.subjectname="";
       document.querySelector('#Languageprefernceid').selected=-1;
     
       //this.subjectid="";                  
      }, 

      fetchmastercategorynameResponse:function(e)
      {

        var arr=e.detail.response.returnval;
        //alert(JSON.stringify(arr));     
      },

      getsubjectname:function()

      {
        this.hidenewsubjectzz=false;
      },

       FnSubmit:function()
      {
        if(this.subjectname==null || this.subjectname=="")
        {
          this.$.subjectname.validate();
        }
      else  if(category=='category1') 
        {
         //alert(category+this.preflang);
         this.$.uiservice.FnSetSubjectInfo(this.subjectid,this.subjectname,category,this.preflang);
         document.querySelector('subject-card').FnRefresh();
          this.$.Languageprefernce.hidden=true;  
         document.querySelector('#Languageprefernceid').selected=-1;
      
       }
   else if(this.subjectname!=null)
   {
        //alert(category+this.preflang);
        subname=this.toTitleCase(this.subjectname);
         this.$.uiservice.FnSetSubjectInfo(this.subjectid,subname,category);
         this.$.newsubmitbox.open();
         document.querySelector('subject-card').FnRefresh();
          this.$.Languageprefernce.hidden=true;  
         document.querySelector('#Languageprefernceid').selected=-1;
      
   }

    },
     toTitleCase:function(str)
    {
        return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
    },

      fnselectlanprefercence:function(e)
      {
      this.preflang=e.target.selectedItem.textContent.trim(); 
       //alert(this.preflang);        
      },
      FnSelectCategoryzzz:function(e)
      {      category=e.target.selectedItem.value;
             this.$.Languageprefernce.hidden=true;    
            if(category=='category1')
            {
              this.$.Languageprefernce.hidden=false;
            }
      },
      Fnclose:function()
      {
        this.$.newsubmitbox.close();
      }

    });
  })();  
  </script>
</dom-module>

